# ステレオタイプとパッケージ構成

- [ステレオタイプ](#ステレオタイプ)
- [パッケージ構成](#パッケージ構成)
- [業務ロジックと状態](#業務ロジックと状態)
- [命名規約](#命名規約)
- [異なるステレオタイプ間のオブジェクトコピー方法](#異なるステレオタイプ間のオブジェクトコピー方法)
- [定数の定義ルール](#定数の定義ルール)

## ステレオタイプ

ステレオタイプの一覧を以下に示す。

| ステレオタイプ | Spring管理[^1]        | 業務ロジック | 状態 | トランザクション管理 | 命名規約（接尾辞） | パッケージ                      |
|----------------|------------|--------------|------|----------------------|--------------------|---------------------------------|
| Controller     | 対象       | 有           | 無   | 無                   | Controller         | <ドメイン>.<機能>.controller    |
| RestController | 対象       | 有           | 無   | 無                   | Controller         | <ドメイン>.<機能>.ajax          |
| Form           | 対象       | 無           | 有   | 無                   | Form               | <ドメイン>.<機能>.form          |
| Request        | 対象       | 無           | 有   | 無                   | Request            | <ドメイン>.<機能>.request       |
| Response       | 対象外     | 無           | 有   | 無                   | Response           | <ドメイン>.<機能>.response      |
| Service        | 対象       | 有           | 無   | 有                   | Service            | <ドメイン>.<機能>.service       |
| Dto            | 対象外     | 無           | 有   | 無                   | Dto                | <ドメイン>.<機能>.dto.<取引>    |
| Mapper         | 対象       | 有           | 無   | 無                   | Mapper             | <ドメイン>.<機能>.mapper        |
| Model          | 対象外     | 無           | 有   | 無                   | -                  | <ドメイン>.<機能>.model.<取引>  |
| ViewHelper     | 対象       | 有           | 無   | 有（読取専用）       | ViewHelper         | <ドメイン>.<機能>.helper        |
| Properties     | 対象       | 無           | 有   | 無                   | Properties         | <ドメイン>.<機能>.configuration |


[^1]: この表での「Spring管理」とは、Springにコンポーネントとして登録する、またはSpringの処理内でインスタンス生成されるものを指している。

ステレオタイプとは、ある責務を持ったクラスの種類のことである。
各ステレオタイプが負った責務の説明は【方式設計書】を参照。


上記表の項目説明は後続の項を参照。


## パッケージ構成


パッケージ構成は、各業務ごとに独立して開発が進められるよう、<ドメイン>.<機能>.<ステレオタイプ>を基本形とする。


| 要素           | 例                                   |
|----------------|--------------------------------------|
| ドメイン       | **com.example**                      |
| 機能           | com.example.**project**              |
| ステレオタイプ | com.example.project.**controller**   |
| 取引           | com.example.project.model.**update** |


取引単位のパッケージ階層は、DtoとModelの2つのステレオタイプのみで使用する。
DtoおよびModelは実装する機能毎に異なる目的、用途で利用されるため、機能間で類似のものがあっても使い回せないことが多い。
このため、DtoとModelに関しては取引単位のパッケージ階層を用意し、取引毎に独立して作成する方針とする。
取引を跨いだDtoやModelの共有は行わない。


## 業務ロジックと状態

ModelやDtoのように値を保持することを責務とするクラスには業務ロジックを持たなせないようにする。
ControllerやServiceのように業務ロジックを持つクラスには、可変な状態を持たせないようにする。

ControllerやService等、Springにコンポーネントとして登録しているクラスはデフォルトでSingletonとなる。
そのため状態を持たせると不具合の原因となりうるので特に注意すること。
ただしFormはリクエストスコープまたはセッションスコープのため状態を持ってもよい。




## 命名規約

基本的に、クラス名にはステレオタイプを接尾辞として付与する。
ただしModelは例外であり接尾辞は不要である。


## 異なるステレオタイプ間のオブジェクトコピー方法

前提として、異なるレイヤーのオブジェクトの授受を行ってはいけない。
レイヤー間でオブジェクトの受け渡しを行う場合、適切なオブジェクトへの変換を行うこととする。
例えば、サービス層のクラス(Service)にプレゼンテーション層に属するオブジェクト(Form)を渡すのは不可で、
この場合、サービス層に属するクラス(Dto)に変換してServiceを呼び出すようにする。

その際、上位レイヤーのオブジェクトにコピーの責務を持たせるようにする。
例えば、Formの内容をDtoに変換したい場合、FormのほうにDtoへの変換メソッドを作成する。
(DtoにFormへの変換メソッドを作るのは、下位レイヤーが上位レイヤーに依存してしまうので不可)

単純なプロパティの移送の場合は、`org.springframework.beans.BeanUtils#copyProperties`を使用する。
`BeanUtils`で移送できない場合はアクセサーメソッドを使用して値の移送を行う。


## 定数の定義ルール

クラス内で使用する定数は可視性`private`とし、クラス外から参照されないようにする。
クラスを跨いで使用する場合は、`Properties`に定数を定義する。

定数を命名する際は、値そのものではなく、その値が表す業務的な意味を反映させる。
例えば、以下の例は値そのものを定数名にしており、文法上は定数であるが意味的にはマジックナンバーと変わりがない。

```java
/** 家族会員数の上限（3人まで）*/
private static final int THREE = 3;
```

業務的な意味を反映させると以下のような命名となる。

```java
/** 家族会員の上限（3人まで）*/
private static final int MAX_FAMILY_MEMBER = 3;
```

# セキュリティ

- [一般的な攻撃への対策](#一般的な攻撃への対策)
  - [SQLインジェクション](#sqlインジェクション)
  - [OSコマンドインジェクション](#osコマンドインジェクション)
  - [ディレクトリトラバーサル](#ディレクトリトラバーサル)
  - [セッション固定化攻撃](#セッション固定化攻撃)
  - [XSS](#xss)
  - [CSRF](#csrf)
  - [HTTPヘッダインジェクション](#httpヘッダインジェクション)
  - [クリックジャッキング](#クリックジャッキング)
  - [バッファオーバーフロー](#バッファオーバーフロー)
- [ログ出力における機密情報の取り扱い](#ログ出力における機密情報の取り扱い)

## 一般的な攻撃への対策

### SQLインジェクション

MyBatisは文字列結合によるクエリ組み立てを行っておらず、内部ではプリペアードステートメントを使用しているため、個々の`Mapper`やMapper XMLで対応を行う必要はない。

ただし、`${...}`形式による値の埋め込みはSQLインジェクションのリスクがあるため、`${...}`形式を使用する場合、埋め込む値は必ず入力精査実施済みの値か固定値のみとすること。

### OSコマンドインジェクション

外部プロセスを起動できるAPIである`Runtime#exec`と`ProcessBuilder`の使用を禁止する。
これらのAPIを使用していないことはArchUnitでチェックする。

### ディレクトリトラバーサル

【方式設計書】通りに実装することで対応する。

### セッション固定化攻撃

Spring Securityがログイン成功時にセッションIDを自動で再生成するため個別で対応を行う必要はない。

### XSS

Thymeleafの`th:text`属性や`th:value`属性、`th:field`属性はHTMLの特殊文字をエスケープするため、これらの属性を使用していれば他に対応を行う必要はない。

ただし、`th:utext`属性はHTMLの特殊文字をエスケープしないため、`th:utext`属性の使用を禁止する。
`th:utext`属性を使用していないことはソースコードレビューでチェックする。

また、jQueryは`$("<div>" + textContent + "</div>")`という形式で文字列結合をして要素を構築すると`textContent`に含まれる値によってはXSSのリスクがある。
そのため文字列結合はせず、必ず`$("<div></div>").text(textContent)`という形式で要素を構築すること。

### CSRF

Spring Securityがすべての`POST`リクエストについて自動でトークンチェックを行うため個々の機能で対応する必要はない。
なお、画面へのトークン埋め込みも自動で行われる。

### HTTPヘッダインジェクション

外部からの入力値をHTTPレスポンスヘッダーへ書き出すことを禁止する。
外部からの入力値をHTTPレスポンスヘッダーへ書き出していないことはソースコードレビューでチェックする。

### クリックジャッキング

Spring Securityにより`X-Frame-Options`レスポンスヘッダーが自動で書き出されるため個々の機能で対応する必要はない。

### バッファオーバーフロー

Javaでは直接メモリを操作することはないため問題はない。

## ログ出力における機密情報の取り扱い

機密情報をログ出力する場合、必ずマスキングを行うこと。

本システムにおける機密情報は次の通り。

- ユーザのパスワード
